LICENSE
PredictHaplo is free software.  The text file COPYING, located in this directory, contains copyright and licensing details. The software package contains a copy of the SCYTHE C++ library (http://scythe.wustl.edu/) which is also published under the GPL.

GENERAL
This software aims at reconstructing haplotypes from next-generation sequencing data. A typical application example is to reconstruct HIV-1 haplotypes present in a blood sample from a patient based on 454/Roche or PacBio reads. 


INSTALLATION
see INSTALL

DOCUMENTATION
Here are some basic informations:

The program is invoked with a configuration file as "PredictHaplo <config_file>", see the hopefully self-contained example file "config_sim". The syntax of this config file is quite simple: lines starting with "%" are treated as comments. 

The first non-comment line specifies a prefix for all files that are created during execution. 
The second such line contains the filename of the reference sequence (in FASTA format), the third line specifies the way how intermediate (local) reconstructions are visualized for better inspection (2: in every local window a html file with all reconstruction results and all aligned reads in this window is stored, 1: only the "interesting" positions are shown in the html file, where interesting mans that they pass an entropy threshold, 0: no visualization).

Then comes the filename of the aligned reads (SAM format), the reads must be aligned to the reference sequence provided in the first line. One way to create such a SAM file is to use the "bwa" aligner (http://bio-bwa.sourceforge.net/) with commands like:
    bwa index <Reference.fasta>
    bwa mem <Reference.fasta> <Reads.fastq>  >  alignedReads.sam
There can be more than one such SAM-file of aligned reads, but each file name must be  specified in a new line (without any other lines between these file names).  
Then comes a flag indicating if there are known "true" haplotypes, followed by the name of the corresponding FASTA file that contains the aligned true haplotypes (alignment w.r.t. the same reference sequence as above. The alignment must have the same length as the reference sequence, s ignore all positions with insertions into the reference!). Fill in some arbitrary string if you don't have such ground-truth. 

The next line is a flag indicating if a local analysis should be performed (must be 1 when run the first time), then comes the maximum number of reads selected in one of the local windows (3000-10000 should be convenient), and finally some entropy threshold which basically specifies the smallest expected haplotype frequency. 

In version 1.0 several additional parameters can be specified: start + stop position of the reconstruction (with respect to the provided reference genome), a quality threshold parameter that selects reads with good alignments to the reference genome, the minimum read length, the maximum fraction of gaps within a read (relative to alignment length), the minimum ratio of alignment score to alignment length, the prior parameter of the multinomial probability tables of the nucleotides at every position, the "min_overlap_factor" (reads must have an overlap with the local reconstruction window of at least this factor times the window size), the "local_window_size_factor" (size of  local reconstruction window relative to average read length), the maximum number of clusters in the truncated Dirichlet process, and the number of MCMC iterations. The last line is an indicator variable for handling deletions in the reads (0 means ignoring deletions; this is useful in regions where one does not expect "true" deletions, together with a sequencing platform that produces reads with many artificial deletions, like PacBio).

DEMO
The package includes a demo file containing 10,000 simulated 454 reads artificially constructed from 10 mutants of the HIV-1 pol gene sequence. The 10 "true" haplotypes are also included; their frequency decays geometrically as (0.5, 0.25, 0.125, etc). With the 10,000 reads provided, you should be able to successfully detect 5-7 haplotypes (there might be small alignment problems that may be analyzed by looking into the automatically created .html files). During execution, progress can be monitored by looking at the created html-files (one per local or "global" window). These html files contain the reference sequence (move with the mouse pointer over a letter to see the position). If true haplotypes are available, these are shown as well, and also the "true" mutations are highlighted in the reference sequence. Then follow the reconstructed haplotypes (in the current analysis window), together with some information about their quality: the "Overlaps" section, where an entry "10:20" means that in every position in the window there are at least 10 reads assigned to one haplotype which have an overlap with this position of 20 (only positions that pass the entropy criterion are counted), and that there is one (or more) position where there are only 10 such reads. Any number x in "10:x" smaller then 10 might indicate that there are problems with this haplotype. If true haplotypes are available, the best matching ones are shown, and the number of errors ("cost"), and the position of these errors (if there are any).
The files for the "local" windows additionally contain all the aligned reads ordered by haplotype assignment. The inferred haplotypes are also output in fasta format (filenames have the following structure: prefix + local/global + window_start + window_stop + .fas).

The alignments of the reads to the reference have been computed with the bwa aligner using the commands:
    bwa index HIV1.fas 
    bwa mem HIV1.fas SimReads071411.fasta >  alignedReads.sam
Alignments of the "true" haplotypes can be computed by any DNA alignment tool (neglect insertions in the reference!). I have computed the alignments by running the R-script "align.R": inside R (http://www.r-project.org/), type
    source("align.R")


